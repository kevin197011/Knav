---
alwaysApply: true
---
# ğŸ¹ Go å¼€å‘è§„èŒƒï¼ˆå·¥å…·å¼€å‘ & Gin Web å…¨æµç¨‹ï¼‰

> ä¸“æ³¨äº Go è¯­è¨€ç°ä»£å¼€å‘æœ€ä½³å®è·µï¼Œæ¶µç›–å·¥å…·/CLIã€Gin Webã€DevOpsã€è‡ªåŠ¨åŒ–æ–‡æ¡£ã€æµ‹è¯•ã€CI/CDã€ç›‘æ§ã€å‰ç«¯å¯¹æ¥ç­‰å®Œæ•´å¼€å‘å‘¨æœŸã€‚

---

## ğŸ¯ Go å¼€å‘åŸåˆ™

- éµå¾ª Go å®˜æ–¹ä»£ç è§„èŒƒå’Œæƒ¯ç”¨æ³•
- ä½¿ç”¨ `gofmt`ã€`golint`ã€`go vet` è¿›è¡Œä»£ç æ£€æŸ¥
- é‡‡ç”¨æ¸…æ™°çš„åŒ…ç»“æ„å’Œå‘½åè§„èŒƒ
- å®æ–½é”™è¯¯å¤„ç†æœ€ä½³å®è·µ
- ä½¿ç”¨æ¥å£è¿›è¡ŒæŠ½è±¡å’Œè§£è€¦

---

## ğŸ— æ¨èé¡¹ç›®ç»“æ„

### Go å·¥å…·/CLI é¡¹ç›®
```
project/
â”œâ”€â”€ cmd/                # ä¸»å‘½ä»¤å…¥å£
â”‚   â””â”€â”€ toolname/
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ internal/           # å†…éƒ¨å®ç°åŒ…ï¼ˆä¸å¯¼å‡ºï¼‰
â”‚   â”œâ”€â”€ logic/
â”‚   â”œâ”€â”€ config/
â”‚   â””â”€â”€ utils/
â”œâ”€â”€ pkg/                # å¯å¤ç”¨åŒ…ï¼ˆå¯å¯¼å‡ºï¼‰
â”œâ”€â”€ scripts/            # æ„å»º/å‘å¸ƒè„šæœ¬
â”œâ”€â”€ tests/              # æµ‹è¯•ä»£ç 
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
â””â”€â”€ LICENSE
```

### Gin Web é¡¹ç›®
```
project/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ handler/        # æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ service/        # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ repository/     # æ•°æ®è®¿é—®
â”‚   â”œâ”€â”€ middleware/     # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ config/         # é…ç½®
â”‚   â””â”€â”€ utils/          # å·¥å…·
â”œâ”€â”€ pkg/                # å…¬å…±åŒ…
â”œâ”€â”€ api/                # OpenAPI/Swagger
â”‚   â””â”€â”€ openapi.yaml
â”œâ”€â”€ deployments/        # Docker/K8s
â”œâ”€â”€ scripts/
â”œâ”€â”€ tests/
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
â””â”€â”€ LICENSE
```

---

## ğŸš€ Gin Web æœåŠ¡æ¨¡æ¿

### main.go
```go
package main

import (
    "context"
    "fmt"
    "log"
    "net/http"
    "os"
    "os/signal"
    "syscall"
    "time"

    "github.com/gin-gonic/gin"
    "github.com/example/project/internal/config"
    "github.com/example/project/internal/handler"
    "github.com/example/project/internal/middleware"
    "github.com/example/project/internal/repository"
    "github.com/example/project/internal/service"
    "github.com/example/project/pkg/logger"
)

func main() {
    cfg, err := config.Load()
    if err != nil {
        log.Fatalf("Failed to load config: %v", err)
    }
    logger := logger.New(cfg.LogLevel)
    db, err := repository.NewDB(cfg.DatabaseURL)
    if err != nil {
        logger.Fatal("Failed to connect to database", "error", err)
    }
    defer db.Close()
    userRepo := repository.NewUserRepository(db)
    userService := service.NewUserService(userRepo, logger)
    userHandler := handler.NewUserHandler(userService, logger)
    router := setupRouter(cfg, userHandler, logger)
    srv := &http.Server{
        Addr:         fmt.Sprintf(":%d", cfg.Port),
        Handler:      router,
        ReadTimeout:  time.Duration(cfg.ReadTimeout) * time.Second,
        WriteTimeout: time.Duration(cfg.WriteTimeout) * time.Second,
        IdleTimeout:  time.Duration(cfg.IdleTimeout) * time.Second,
    }
    go func() {
        logger.Info("Starting server", "port", cfg.Port)
        if err := srv.ListenAndServe(); err != nil && err != http.ErrServerClosed {
            logger.Fatal("Failed to start server", "error", err)
        }
    }()
    quit := make(chan os.Signal, 1)
    signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM)
    <-quit
    logger.Info("Shutting down server...")
    ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)
    defer cancel()
    if err := srv.Shutdown(ctx); err != nil {
        logger.Fatal("Server forced to shutdown", "error", err)
    }
    logger.Info("Server exited")
}

func setupRouter(cfg *config.Config, userHandler *handler.UserHandler, logger logger.Logger) *gin.Engine {
    if cfg.Environment == "production" {
        gin.SetMode(gin.ReleaseMode)
    }
    router := gin.New()
    router.Use(middleware.Logger(logger))
    router.Use(middleware.Recovery(logger))
    router.Use(middleware.CORS())
    router.Use(middleware.RateLimiter())
    router.GET("/health", func(c *gin.Context) {
        c.JSON(http.StatusOK, gin.H{
            "status":    "healthy",
            "timestamp": time.Now().UTC(),
        })
    })
    api := router.Group("/api/v1")
    {
        users := api.Group("/users")
        {
            users.POST("", userHandler.CreateUser)
            users.GET("", userHandler.ListUsers)
            users.GET(":id", userHandler.GetUser)
            users.PUT(":id", userHandler.UpdateUser)
            users.DELETE(":id", userHandler.DeleteUser)
        }
    }
    return router
}
```

---

## ğŸ§© ä¸šåŠ¡åˆ†å±‚æ¥å£ç¤ºä¾‹

### model/user.go
```go
type User struct {
    ID        int64     `json:"id" db:"id"`
    Name      string    `json:"name" db:"name"`
    Email     string    `json:"email" db:"email"`
    CreatedAt time.Time `json:"created_at" db:"created_at"`
    UpdatedAt time.Time `json:"updated_at" db:"updated_at"`
}
```

### repository/user_repository.go
```go
type Repository interface {
    Create(ctx context.Context, user *User) error
    GetByID(ctx context.Context, id int64) (*User, error)
    GetByEmail(ctx context.Context, email string) (*User, error)
    Update(ctx context.Context, user *User) error
    Delete(ctx context.Context, id int64) error
    List(ctx context.Context, limit, offset int) ([]*User, error)
}
```

### service/user_service.go
```go
type Service interface {
    CreateUser(ctx context.Context, req *CreateUserRequest) (*User, error)
    GetUser(ctx context.Context, id int64) (*User, error)
    UpdateUser(ctx context.Context, id int64, req *CreateUserRequest) (*User, error)
    DeleteUser(ctx context.Context, id int64) error
    ListUsers(ctx context.Context, page, limit int) ([]*User, error)
}
```

---

## ğŸ”§ å·¥å…·ç±»ä¸æ—¥å¿—

### pkg/logger/logger.go
```go
// ç»“æ„åŒ–æ—¥å¿—æ¥å£ä¸å®ç°ï¼Œæ”¯æŒ trace_idã€åˆ†çº§ã€JSON è¾“å‡º
// ...è§ä¸Šæ–‡è¯¦ç»†ä»£ç ...
```

### pkg/httpclient/client.go
```go
// é€šç”¨ HTTP å®¢æˆ·ç«¯ï¼Œæ”¯æŒé‡è¯•ã€æ—¥å¿—ã€è¶…æ—¶ã€JSON è§£ç 
// ...è§ä¸Šæ–‡è¯¦ç»†ä»£ç ...
```

### internal/config/config.go
```go
// ç¯å¢ƒå˜é‡ä¼˜å…ˆçš„é…ç½®åŠ è½½ï¼Œæ”¯æŒå¤šç¯å¢ƒã€æ ¡éªŒã€é»˜è®¤å€¼
// ...è§ä¸Šæ–‡è¯¦ç»†ä»£ç ...
```

---

## ğŸ§ª æµ‹è¯•è§„èŒƒ

- å•å…ƒæµ‹è¯•ç”¨ Go æ ‡å‡† testing åŒ… + testify/assert/mock
- é›†æˆæµ‹è¯•ç”¨ httptest + suite + äº‹åŠ¡éš”ç¦»
- æ¨èç»“æ„ï¼š`internal/service/xxx_test.go`ã€`tests/integration/xxx_test.go`
- è§ä¸Šæ–‡è¯¦ç»†å•å…ƒ/é›†æˆæµ‹è¯•ä»£ç 

---

## ğŸ“š è‡ªåŠ¨åŒ–æ–‡æ¡£ä¸ OpenAPI

### 1. ä½¿ç”¨ swaggo ç”Ÿæˆ Swagger/OpenAPI
- `go install github.com/swaggo/swag/cmd/swag@latest`
- `go get -u github.com/swaggo/gin-swagger`
- `go get -u github.com/swaggo/files`
- åœ¨ main.go å’Œ handler æ³¨é‡Šä¸­æ·»åŠ  swagger æ³¨è§£
- `swag init` ç”Ÿæˆ docs
- è·¯ç”±æ³¨å†Œï¼š
```go
import (
    ginSwagger "github.com/swaggo/gin-swagger"
    swaggerFiles "github.com/swaggo/files"
)
r.GET("/swagger/*any", ginSwagger.WrapHandler(swaggerFiles.Handler))
```

### 2. å‰ç«¯ä»£ç ç”Ÿæˆ
- æ¨è openapi-generator æˆ– swagger-typescript-api
- ç”Ÿæˆ TypeScript å®¢æˆ·ç«¯ï¼Œå‰ç«¯ç›´æ¥è°ƒç”¨
- ç¤ºä¾‹ï¼š
```sh
openapi-generator-cli generate -i http://localhost:8080/swagger/doc.json -g typescript-fetch -o frontend/src/api
# æˆ–
swagger-typescript-api -p http://localhost:8080/swagger/doc.json -o frontend/src/api -n assetApi.ts
```

---

## ğŸ“ˆ ç›‘æ§ä¸è¿ç»´

- æ¨èé›†æˆ Prometheus metricsï¼ˆå¦‚ gin-prometheusã€promhttpï¼‰
- æ—¥å¿—ç»“æ„åŒ–è¾“å‡ºï¼Œtrace_id è´¯ç©¿å…¨é“¾è·¯
- å¥åº·æ£€æŸ¥ `/health` è·¯ç”±
- Dockerfileã€K8s YAMLã€CI/CDï¼ˆGitHub Actionsï¼‰å…¨æµç¨‹è‡ªåŠ¨åŒ–

---

## ğŸ–¥ï¸ å‰ç«¯å¯¹æ¥å»ºè®®

- å‰ç«¯ï¼ˆå¦‚ React+Tailwindï¼‰ç”¨ OpenAPI ç”Ÿæˆçš„ TypeScript å®¢æˆ·ç«¯
- å…¸å‹ CRUD é¡µé¢ç»“æ„ï¼š
  - èµ„äº§è¡¨æ ¼ç»„ä»¶ AssetTable
  - èµ„äº§è¡¨å•ç»„ä»¶ AssetForm
  - ä¸»é¡µé¢ AssetsPage
- è§ä¸Šæ–‡è¯¦ç»†ä»£ç æ¨¡æ¿

---

## ğŸ§ª CI/CD & DevOps

- æ¨è GitHub Actions æµæ°´çº¿ï¼Œè‡ªåŠ¨æµ‹è¯•ã€æ„å»ºã€é•œåƒæ¨é€ã€éƒ¨ç½²
- å…³é”®æ­¥éª¤ï¼š
  - ä»£ç æ£€æŸ¥ï¼ˆgofmtã€golintã€go vetï¼‰
  - å•å…ƒ/é›†æˆæµ‹è¯•
  - æ„å»ºäºŒè¿›åˆ¶/é•œåƒ
  - è‡ªåŠ¨åŒ–éƒ¨ç½²

---

## å‚è€ƒä»£ç ä¸æœ€ä½³å®è·µ

- è§æœ¬è§„èŒƒå„èŠ‚ä»£ç å—ï¼Œæˆ–å‚è€ƒ [Go å®˜æ–¹æ–‡æ¡£](https://golang.org/doc/)ã€[Gin å®˜æ–¹æ–‡æ¡£](https://gin-gonic.com/)ã€[swaggo](https://github.com/swaggo/swag)ã€[openapi-generator](https://openapi-generator.tech/)

---

å¦‚éœ€è¡¥å……å…·ä½“æ¨¡å—ã€è„šæ‰‹æ¶ã€CI/CDã€ç›‘æ§ã€å‰ç«¯å¯¹æ¥ç­‰ç»†èŠ‚ï¼Œè¯·éšæ—¶è¡¥å……ï¼

